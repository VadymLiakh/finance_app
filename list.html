{% extends 'base.html' %}
{% block container_class %}container wide-container{% endblock %}

{% block content %}
<h2>üìã –í—Å—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó</h2>

<form method="GET" class="filter-form">
    <label>–¢–∏–ø:
        <select name="type">
            <option value="">–í—Å—ñ</option>
            <option value="income" {% if request.args.get('type') == 'income' %}selected{% endif %}>–î–æ—Ö—ñ–¥</option>
            <option value="expense" {% if request.args.get('type') == 'expense' %}selected{% endif %}>–í–∏—Ç—Ä–∞—Ç–∞</option>
        </select>
    </label>
    <label>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:
        <select name="category">
            <option value="">–í—Å—ñ</option>
            {% for cat in categories %}
                <option value="{{ cat.id }}" {% if request.args.get('category') == cat.id|string %}selected{% endif %}>{{ cat.name }}</option>
            {% endfor %}
        </select>
    </label>
    <label>–î–∞—Ç–∞ –≤—ñ–¥:
        <input type="date" name="date_from" value="{{ request.args.get('date_from', '') }}">
    </label>
    <label>–î–∞—Ç–∞ –¥–æ:
        <input type="date" name="date_to" value="{{ request.args.get('date_to', '') }}">
    </label>
    <label>–ú—ñ–Ω. —Å—É–º–∞:
        <input type="number" name="min_amount" step="0.01" value="{{ request.args.get('min_amount', '') }}">
    </label>
    <label>–ú–∞–∫—Å. —Å—É–º–∞:
        <input type="number" name="max_amount" step="0.01" value="{{ request.args.get('max_amount', '') }}">
    </label>
    <button type="submit" class="small-btn">üîç –ü–æ—à—É–∫</button>
</form>

<table>
    <thead>
        <tr>
            <th>–î–∞—Ç–∞</th>
            <th>–¢–∏–ø</th>
            <th>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</th>
            <th>–°—É–º–∞</th>
            <th>–û–ø–∏—Å</th>
            <th>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</th>
            <th>–í–∏–¥–∞–ª–∏—Ç–∏</th>
        </tr>
    </thead>
    <tbody>
        {% for t in transactions %}
        <tr>
            <td>{{ t.date }}</td>
            <td>{{ '–î–æ—Ö—ñ–¥' if t.type == 'income' else '–í–∏—Ç—Ä–∞—Ç–∞' }}</td>
            <td>{{ t.category.name if t.category else '' }}</td>
            <td>{{ "%.2f"|format(t.amount) }} –≥—Ä–Ω</td>
            <td>{{ t.description or '' }}</td>
            <td class="action-cell">
                <a href="{{ url_for('transactions.edit_transaction', transaction_id=t.id) }}" class="small-btn">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
            </td>
            <td class="action-cell">
                <form method="POST" action="{{ url_for('transactions.delete_transaction', transaction_id=t.id) }}" onsubmit="return confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é?');">
                    <button type="submit" class="small-btn red">–í–∏–¥–∞–ª–∏—Ç–∏</button>
                </form>
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="7" style="text-align:center;">–ù–µ–º–∞—î —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
